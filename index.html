<!doctype html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

        <title>Socket.IO chat</title>

        <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
        <script src="/bower_components/webcomponentsjs/webcomponents.js"></script>

        <link rel="import" href="/bower_components/polymer/polymer.html">
        <link rel="import" href="/bower_components/core-icon/core-icon.html">
        <link rel="import" href="/bower_components/paper-input/paper-input.html">
        <link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
        <link rel="import" href="/bower_components/paper-shadow/paper-shadow.html">

        <style>
            paper-input {
                padding: 10px;
            }
            paper-shadow {
                margin: 5px;
                padding: 10px;
                float: left;
            }
        </style>

        <script>
            function onLoad() {
                var socket = io();
                var inputNode = document.getElementById("text");
                var messagesList = document.getElementById("messages");
                var button = document.getElementById("button");

                function sendMessage() {
                    socket.emit('chat message', inputNode.value);
                    inputNode.value = "";
                }

                function onKeypress(evt) {
                    if (evt.which == 13) {
                        sendMessage();
                    }
                }

                inputNode.addEventListener('keypress', onKeypress);
                button.addEventListener('click', sendMessage);

                socket.on('chat message', function(msg) {
                    var shadow = document.createElement('paper-shadow');
                    shadow.innerHTML = msg;
                    messagesList.appendChild(shadow);
                });
            }
        </script>
    </head>
    <body onLoad="onLoad()" fullbleed unresolved vertical layout>
        <div id="messages" flex vertical layout start></div>
        <div horizontal layout center>
            <paper-input id="text" label="Enter message to send" flex>
            </paper-input>
            <paper-icon-button id="button" icon="send">
            </paper-icon-button>
        </div>
    </body>
</html>
