<!doctype html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

        <title>Socket.IO chat</title>

        <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
        <script src="/bower_components/webcomponentsjs/webcomponents.js"></script>

        <link rel="import" href="/bower_components/polymer/polymer.html">
        <link rel="import" href="/bower_components/paper-shadow/paper-shadow.html">
        <link rel="import" href="/elements/chat-message-editor.html">

        <style>
            paper-shadow {
                margin: 5px;
                padding: 10px;
                float: left;
            }
        </style>

        <script>
            function onLoad() {
                var socket = io();
                var messagesList = document.getElementById("messages");
                var editor = document.getElementById("editor");

                function sendMessage(ev) {
                    socket.emit('chat message', ev.detail.message);
                }

                editor.addEventListener('message', sendMessage);

                socket.on('chat message', function(msg) {
                    var shadow = document.createElement('paper-shadow');
                    shadow.innerHTML = msg;
                    messagesList.appendChild(shadow);
                });
            }
        </script>
    </head>
    <body onLoad="onLoad()" fullbleed unresolved vertical layout>
        <div id="messages" flex vertical layout start></div>
        <chat-message-editor id="editor"></chat-message-editor>
    </body>
</html>
