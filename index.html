<!doctype html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

        <title>Socket.IO chat</title>

        <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
        <script src="/bower_components/webcomponentsjs/webcomponents.js"></script>

        <link rel="import" href="/bower_components/polymer/polymer.html">
        <link rel="import" href="/bower_components/core-icon/core-icon.html">
        <link rel="import" href="/bower_components/paper-input/paper-input-decorator.html">
        <link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
        <link rel="import" href="/bower_components/paper-shadow/paper-shadow.html">

        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                font: 13px Helvetica, Arial;
            }
            form {
                position: fixed;
                bottom: 0;
                width: 100%;
            }
            form paper-input-decorator {
                position: fixed;
                bottom: 0;
                padding: 10px;
                width: 90%;
                margin-right: .5%;
            }
            form paper-icon-button {
                position: fixed;
                bottom: 0;
                right: 0;
                margin: 0 20px 10px 0;
            }
            #messages {
                display: flex;
                flex-direction: column;
            }
            paper-shadow {
                margin: 5px;
                padding: 10px;
                float: left;
                align-self: flex-start;
            }
        </style>

        <script>
            function onLoad() {
                var socket = io();
                var inputNode = document.getElementById("text");
                var messagesList = document.getElementById("messages");
                var textForm = document.getElementById("textForm");
                var button = document.getElementById("button");

                function onSubmit(evt) {
                    socket.emit('chat message', inputNode.value);
                    inputNode.value = "";
                    evt.preventDefault();
                }

                textForm.addEventListener('submit', onSubmit);
                button.addEventListener('click', onSubmit);

                socket.on('chat message', function(msg) {
                    var shadow = document.createElement('paper-shadow');
                    shadow.innerHTML = msg;
                    messagesList.appendChild(shadow);
                });
            }
        </script>
    </head>
    <body onLoad="onLoad()">
        <div id="messages"></div>
        <form id="textForm" action="">
            <paper-input-decorator id="decorator" label="Enter message to send">
                <input id="text" autocomplete="off" autofocus/>
            </paper-input-decorator>
            <paper-icon-button id="button" icon="send"></paper-icon-button>
        </form>
    </body>
</html>
